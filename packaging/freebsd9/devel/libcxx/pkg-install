set -e
if test "$2" = "TEST-GCC"
then
	cat >$WRKDIR/test.gcc.c <<EOF
#if __GNUC__ * 10000 + __GNUC_MINOR__ * 100 + __GNUC_PATCHLEVEL__ < 40702
#error You must update your lang/gcc47 port
#endif
EOF
	$CC -c -o $WRKDIR/test.gcc.o $WRKDIR/test.gcc.c
	exit 0
fi

if test "$2" = "POST-INSTALL"
then

# make install runs the default install, which installs the config files, so
# move them to .dist; package tarballs contain the .dist-s, move them back.

	for f in ${PKG_PREFIX}/etc/tlsparams/system.dh.conf ${PKG_PREFIX}/etc/tlsparams/system.rsa.conf ${PKG_PREFIX}/var/tlsparams/system.dh ${PKG_PREFIX}/var/tlsparams/system.rsa
	do
		if test ! -f "$f".dist
		then
			cp -f "$f" "$f.dist"
		fi

		if test ! -f "$f"
		then
			cp -f "$f.dist" "$f"
		fi
	done

	if test -f ${PKG_PREFIX}/sbin/httpd
	then
		for d in ${PKG_PREFIX}/etc/apache*/Includes
		do
			if test -d "$d"
			then
				ln -s ${PKG_PREFIX}/share/libcxx/apache.conf $d/httportmap.conf
			fi
		done

		for f in ${PKG_PREFIX}/etc/apache*/mime.types
		do
			if test -f "$f"
			then
				if test ! -e ${PKG_PREFIX}/share/libcxx/mime.types
				then
					ln -s "$f" ${PKG_PREFIX}/share/libcxx/mime.types
				fi
			fi
		done
	fi
fi
